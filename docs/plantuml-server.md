---
title: PlantUML / Server
---
# [PlantUML](plantuml.md) / Server

  - [The servlet for server side](http://plantuml.com/server) #ril
  - [PlantUML & GitLab \| GitLab](https://docs.gitlab.com/ee/administration/integration/plantuml.html)
      - Before you can enable PlantUML in GitLab; you need to set up your own PlantUML server that will generate the diagrams.

        動態透過 PlantUML server 轉成圖形；實測下來，是由 browser 對 PlantUML server 發出請求，也就是 GitLab server 只幫忙把 diagram 的語法編進 URL。

      - With Docker, you can just run a container like this: `docker run -d --name plantuml -p 8080:8080 plantuml/plantuml-server:tomcat`

        The PlantUML URL will be the hostname of the server running the container.

  - [How long do the images generated by PlantUML Server live for? - Frequently Asked Questions](http://plantuml.com/faq#3)
      - Links to png or svg generated by PlantUML Server are valid forever (that is as long as the server is up). However, WE DO NOT STORE ANY DIAGRAMS ON OUR SERVERS.
      - This may sound contradictory. It is not: the whole diagram is COMPRESSED INTO THE URL ITSELF. When the server receives the URL, it decompresses the URL to retrieve the diagram text and generates the image. There is no need to store anything. Even if the server is down, you can retrieve the diagram using the flag `-decodeurl` with the command line. Furthermore, the diagram data is stored in PNG metadata, so you can fetch it even from a downloaded image.

        原來像 http://www.plantuml.com/plantuml/uml/SoWkIImgAStDuNBAJrBGjLDmpCbCJbMmKl18pSd9rr48po_AIL7aSaZDIm4g0W00 這樣的 URL，其產生的圖形為 http://www.plantuml.com/plantuml/png/SoWkIImgAStDuNBAJrBGjLDmpCbCJbMmKl18pSd9rr48po_AIL7aSaZDIm4g0W00，後面 `SoWkI...g0W00` 這一整串應該就是 `@startuml ... @enduml` 編碼的結果。

      - Occasionally we may activate HTTP traces on our server. This is mainly for performance issues (when we have some) to understand the traffic we get. Once the issue solved, we turn back off HTTP traces and we remove the logs.
      - Note that we are also counting the number of diagrams generated (printed at the home page) to measure general server load.
      - Concerning sensitive content: even if we do not store the generated diagrams, please be aware that all traffic goes through HTTP, so it's easy to catch. So you should probably install a LOCAL SERVER on your own network if you plan to generate diagrams with sensitive information.

  - [plantuml/plantuml\-server \- Docker Hub](https://hub.docker.com/r/plantuml/plantuml-server/) #ril

## Cache ??

參考資料：

  - [How long do the images generated by PlantUML Server live for? - Frequently Asked Questions](http://plantuml.com/faq#3)

      - Links to png or svg generated by PlantUML Server are valid forever (that is as long as the server is up). However, WE DO NOT STORE ANY DIAGRAMS ON OUR SERVERS.

        因此快取肯定做在 client 端。

  - [Draw images for PlantUML markup reachable via URL? · Issue \#4 · plantuml/plantuml\-server](https://github.com/plantuml/plantuml-server/issues/4) #ril

      - arnaudroques (contributor): Yes, by default, PlantUML server sends some Cache-Control/public header for images. This makes sense for text diagram without `!include`.

        We cannot simply remove it for every served image, but we could improve this behaviour: For example, if we detect some `!include` directive in the diagram, we could change the header to Cache-Control/no cache.

        This is something we have ALREADY IMPLEMENTED very basically, see https://github.com/plantuml/plantuml/blob/master/src/net/sourceforge/plantuml/StringUtils.java#L333 但不是檢查有沒有 `!include` XD

        So you can even check now is the following URL gives the right HTTP header http://www.plantuml.com/plantuml/png/AqijAixCpmC0

            $ curl -I http://www.plantuml.com/plantuml/png/AqijAixCpmC0 # 確實沒有 Cache-Control header
            HTTP/1.1 200 OK
            Access-Control-Allow-Origin: *
            Content-Type: image/png
            X-PlantUML-Measure: 1/32/148
            X-PlantUML-Diagram-Width: 481
            X-PlantUML-Diagram-Height: 311
            Content-Length: 20397
            Server: PlantUML/0.6

            $ java -jar plantuml.jar -decodeurl AqijAixCpmC0
            @startuml
            @startuml
            version
            @enduml
            @enduml
            No diagram found

        做一些實驗確認加 `@startuml` 緊接著 `version` 的用法可以停用快取：

            $ cat cache.puml
            @startuml
            Bob -> Alice : hello
            @enduml

            $ cat nocache.puml
            @startuml
            version
            Bob -> Alice : hello
            @enduml

            $ java -jar plantuml.jar -encodeurl cache.puml
            SyfFKj2rKt3CoKnELR1Io4ZDoSa70000
            No diagram found

            $ java -jar plantuml.jar -encodeurl nocache.puml
            AqijAixCp-DooazIqBLJSCp9J4vLi5B8ICt9oGS0
            No diagram found

            $ curl -I http://www.plantuml.com/plantuml/png/SyfFKj2rKt3CoKnELR1Io4ZDoSa70000 # cache
            HTTP/1.1 200 OK
            Date: Thu, 25 Apr 2019 03:14:51 GMT
            Content-Type: image/png
            Content-Length: 1514
            Last-Modified: Sun, 13 May 2018 13:17:06 GMT
            ETag: "5af83ad2-5ea"
            Expires: Thu, 25 Apr 2019 23:30:00 GMT
            Cache-Control: max-age=72909
            Accept-Ranges: bytes
            Server: PlantUML/0.6

            $ curl -I http://www.plantuml.com/plantuml/png/AqijAixCp-DooazIqBLJSCp9J4vLi5B8ICt9oGS0 # no-cache
            HTTP/1.1 400 Bad Request <-- 因為 version 只能單獨使用?
            Access-Control-Allow-Origin: *
            Content-Type: image/png
            X-PlantUML-Measure: 1/14/395
            X-PlantUML-Diagram-Width: 565
            X-PlantUML-Diagram-Height: 432
            Content-Length: 26963
            Server: PlantUML/0.6

# 參考資料 {: #reference }

  - [plantuml/plantuml-server - GitHub](https://github.com/plantuml/plantuml-server)
  - [plantuml/plantuml-server - Docker Hub](https://hub.docker.com/r/plantuml/plantuml-server/)

工具：

  - [Online Demo Server](http://www.plantuml.com/plantuml/uml/) 跑的正是 PlantUML Server
  - [PlantUML Editor](https://plantuml-editor.kkeisuke.com/)
  - [LiveUML](https://liveuml.com/) - 自動刷新
