<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="https://imsardine.github.io/dev-notes/workday-auth/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>Workday / Authentication - 建造以學習 | 在電梯裡遇見雙胞胎</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/3.003/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.min.css">
    <link href="../cinder_extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">建造以學習 | 在電梯裡遇見雙胞胎</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/imsardine/dev-notes/blob/source/docs/workday-auth.md">Edit on imsardine/dev-notes</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#workday-authentication">Workday / Authentication</a></li>
            <li class="second-level"><a href="#saml">SAML</a></li>
                
            <li class="second-level"><a href="#reference">參考資料</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="workday-authentication"><a href="../workday/">Workday</a> / Authentication<a class="headerlink" href="#workday-authentication" title="Permanent link"> #</a></h1>
<ul>
<li><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/MtfgoUieSOZyoJwKmIi_6A">Change Workday Password for User • Authentication and Security • Reader • Administrator Guide</a> #ril</li>
<li><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/OFHl2aPfIZOfT5wfWfppsA">Configure Password Reset • Authentication and Security • Reader • Administrator Guide</a> #ril</li>
</ul>
<h2 id="saml">SAML<a class="headerlink" href="#saml" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/isnv08HWriJaS_fTijJoRA">Concept: SAML Authentication • Authentication and Security • Reader • Administrator Guide</a></p>
<ul>
<li>
<p>You can use Security Assertion Markup Language (SAML) for single sign-on (SSO) and single logout (SLO) ?? in Workday. SAML is a standard for exchanging authentication and AUTHORIZATION data between SECURITY DOMAINS, enabling you to centrally manage user credentials through a third-party identity provider (IdP).</p>
<p>Example: A security administrator can disable a user&rsquo;s account without directly signing in to Workday.</p>
</li>
<li>
<p>Workday supports the SAML 2.0 SSO standard for signing in to Workday from other identity providers.</p>
</li>
</ul>
<p>How SAML Works</p>
<ul>
<li>
<p>When you enable SAML authentication for signing in to Workday:</p>
<ul>
<li>Your SAML IdP authenticates users and sends a SAML response message to Workday.</li>
<li>Workday either grants or denies access to a user based on the SAML ASSERTION in the message.</li>
</ul>
</li>
<li>
<p>You can configure 2 types of FLOWS in Workday based on WHO SENDS THE FIRST SAML MESSAGE:</p>
<ul>
<li>In IdP-initiated SAML, the SAML PROVIDER sends an unsolicited SAML response message to Workday.</li>
<li>In SP-initiated SAML, Workday sends a SAML AUTHENTICATION REQUEST message to your SAML provider.</li>
</ul>
<p>第一則 SAML provider 指的是 IdP，因為提供 SAML assertion 的不會是 SP (Workday)。</p>
</li>
<li>
<p>When you enable SAML for signing out of Workday using your IdP, you can configure 2 types of flows in Workday based on who sends the first SAML message:</p>
<ul>
<li>In IdP-initiated SLO, your SAML provider sends a SAML LogoutRequest message to Workday.</li>
<li>In Workday-initiated SLO, Workday signs the user out of Workday and sends a SAML LogoutRequest message to your IdP.</li>
</ul>
</li>
<li>
<p>During the SAML authentication process, all SAML messages must:</p>
<ul>
<li>Pass through the user&rsquo;s browser or mobile client. Workday doesn&rsquo;t support SAML Artifacts. ??</li>
<li>
<p>Use HTTPS.</p>
</li>
<li>
<p>Be signed if they are incoming to Workday.</p>
<p>相反地，如果由 Workday 這端發出 request 或返回 response，也要用自己的 private key 簽署過。</p>
</li>
</ul>
</li>
</ul>
<p>Redirect URLs</p>
<ul>
<li>
<p>SAML redirect URLs facilitate the integration of SAML with Workday. Specify redirect URLs as alternative URLs to reference when users make unauthenticated requests to Workday. These redirect URLs:</p>
<ul>
<li>Apply to the Sign In to Workday page, the Workday Sign Out button, and DEEPLINKs that reference Workday authentication URLs.</li>
<li>Must use HTTPS.</li>
<li>Apply to all users.</li>
</ul>
<p>當使用者直接對 Workday 存取時，要先轉去哪裡做驗證?</p>
<p>Redirect URL 跟 SAML request 的關係是什麼??</p>
</li>
<li>
<p>To avoid continuous loops when the IdP session is still active, use different URLs for the Login Redirect URL and Logout Redirect URL. In addition, if you&rsquo;re not using SLO, signing out of Workday doesn&rsquo;t end a user&rsquo;s IdP session, which might enable the user to access Workday again without authenticating.</p>
<p>所謂 SLO 是登出整個 IdP session。</p>
</li>
</ul>
<p>SAML Deeplinks</p>
<ul>
<li>
<p>When Workday receives an authentication request from a user accessing a deeplink, such as when a user clicks an email link, Workday stores deeplinks during SSO redirects for both IdP-initiated and SP-initiated SAML.</p>
<p>完成登入後，會把使用者帶到原先想存取的頁面。</p>
</li>
</ul>
<p>X.509 and SAML</p>
<ul>
<li>
<p>Workday&rsquo;s SAML features require that you use X.509 certificates to sign SAML messages.</p>
<p>不論是 SSO 或 SLO，不論是 IdP-initiated 或 Workday-initiated，送出訊息的一方都會用自己的 X.509 private key 簽署，另一方則用對應的 X.509 public key 確認來源，中間一定是走 HTTPS。</p>
</li>
<li>
<p>You must create an X.509 public key in Workday to verify the digital signature on incoming SAML sign in and sign out requests. Your IdP must use a corresponding X.509 private key to sign those files.</p>
<p>這裡 sign in/out request 指的都是 IdP-iniated SAML/SLO，所以是 IdP 端用它的 private key 簽署，而 SP 這端 (Workday) 則用對應的 public key 檢查。</p>
</li>
<li>
<p>To configure Workday to participate in SAML sign out transactions, you must create an X.509 private key pair in Workday, and ensure that the public key is available to your IdP.</p>
<p>When Workday generates SAML sign out request and sign out response messages, it uses the X.509 private key to sign the messages. Your IdP uses the corresponding X.509 public key to verify that the SAML sign out requests and responses came from your Workday tenant. Public keys must be in PEM format.</p>
<p>這裡指的是 SP-initiated SAML/SLO，所以是 SP 這端 (Workday) 用自己的 private key 簽署，而 IdP 顱則用對應的 public key 檢查。</p>
<p>為什麼這裡只講 sign out? 因為轉去 IdP 那邊真的會觸發 logout，所以要先由 Workday 這邊 sign 過? 為什麼 sign-on 不用 Workday 這方的 private key? 因為不會實際產生動作，只是帶到要輸入帳密的頁面??</p>
<p>從 &ldquo;sign out response&rdquo; 看來，即便是 IdP-initiated SAML/SLO，當 SP (Workday) 產生 response 時，也會用到自己的 private key。</p>
</li>
</ul>
</li>
<li>
<p><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/1SrUii41GTc5l3k14I02lA">Configure Identity Provider-Initiated SAML Authentication • Authentication and Security • Reader • Administrator Guide</a> #ril</p>
<p>Prerequisites</p>
<ul>
<li>Enable Security Assertion Markup Language (SAML) authentication and set up 1 OR MORE SAML identity providers (IdPs) for your tenant.</li>
<li>Security: Set Up: Tenant Setup - Security domain in the System functional area.</li>
</ul>
<p>Context</p>
<ul>
<li>Configure additional settings and SAML redirect URLs for IdP-initiated SAML authentication.</li>
</ul>
<p>Steps</p>
<ol>
<li>
<p>Access the Edit Tenant Setup - Security task.</p>
</li>
<li>
<p>In the SAML Setup section, configure settings for IdP-initiated SAML.</p>
</li>
</ol>
</li>
<li>
<p><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/eFGI5mDeWCUC9rCSrUSyYA">Configure Service Provider-Initiated SAML Authentication • Authentication and Security • Reader • Administrator Guide</a> #ril</p>
<p>Prerequisites</p>
<ul>
<li>Enable SAML (Security Assertion Markup Language) authentication and set up the SAML identity providers for your tenant.</li>
<li>Get the URLs for the SAML providers where Workday must send AUTHENTICATION REQUESTS (IdP SSO Service URL).</li>
<li>Security: Set Up: Tenant Setup - Security domain in the System functional area.</li>
</ul>
<p>Context</p>
<ul>
<li>
<p>Configure Service Provider (SP)-initiated SAML authentication for your tenant. Workday supports 1 SP-initiated SAML configuration PER ENVIRONMENT.</p>
<p>這跟 IdP-initiated 很不一樣，因為 Workday 發現使用者未登入時，只能轉往一個地方做驗證。</p>
</li>
</ul>
<p>Steps</p>
<ol>
<li>
<p>Access the Edit Tenant Setup - Security task.</p>
</li>
<li>
<p>In the SAML Identity Providers grid for each environment for which you&rsquo;re configuring SP-initiated SAML, consider:</p>
<ul>
<li>
<p>SP Initiated</p>
<p>Select to specify SP-initiated SAML authentication for the environment selected in the Used for Environments field.</p>
<p>若 SAML Identity Providers 表格就是給 SP-initiated SAML 用的，為什麼還要特別勾這個??</p>
</li>
<li>
<p>Service Provider ID</p>
<p>Identifies Workday as the service provider in the <code>Issuer</code> element in SAML messages sent to the IdP.</p>
<p>別跟表格中的 Issuer 欄位搞混，那是指 incoming reqest/response 從 IdP 那端來的 issuer。</p>
</li>
<li>
<p>Sign SP-initiated Request</p>
<p>(Optional) Workday signs authentication request messages with the private key (x509 Private Key Pair). You need to provide the public key to your SAML providers.</p>
<p>因為 authentication request 沒有實質作用，只是把使用者帶往輸入帳密的頁面，所以才會是 optional??</p>
</li>
<li>
<p>Do Not Deflate SP-initiated Request</p>
<p>(Optional) If the IdP deflates the authentication request message, select this check box to ensure that Workday doesn&rsquo;t try to deflate the message again. ??</p>
</li>
<li>
<p>Always Require IdP Authentication</p>
<p>(Optional) Select the check box and an option to require users to reauthenticate even if they already have a session with their IdP. To force reauthentication if your IdP is ADFS 2.0, you must select the Force Authn and RequestedAuthnContext option. ??</p>
</li>
<li>
<p>IdP SSO Service URL</p>
<p>Enter the URL where Workday sends SAML authentication requests. You can get this information from your SAML provider.</p>
</li>
</ul>
</li>
<li>
<p>Configure additional settings for SP-initiated SAML. As you complete the task, consider:</p>
<ul>
<li>
<p>x509 Private Key Pair</p>
<p>Select or create the X.509 private key pair that Workday uses to sign SAML sign in and sign out requests. You need to provide the public key to your SAML providers.</p>
</li>
<li>
<p>Authentication Request Signature Method</p>
<p>Workday requires that you use SHA256 as the method for signing authentication requests if you select the Sign SP-initiated Authentication Request check box.</p>
</li>
<li>
<p>Enable Signature KeyInfo Validation</p>
<p>(Optional) Workday compares the optional SAML <code>keyInfo</code> element (if present) in incoming SAML messages with the stored SAML public key of your tenant. If the values don&rsquo;t match, Workday rejects the authentication request and records an error message on the Signons and Attempted Signons report.</p>
</li>
<li>
<p>Additional Negative Skew (in minutes), Additional Positive Skew (in minutes)</p>
<p>(Optional) The number of minutes to add to the <code>NotBefore</code>/<code>NotOnOrAfter</code> time (the current time minus/plus the SKEW TIME) when processing the validity of a SAML assertion.</p>
<p>Workday enforces a combined maximum of 3 minutes in either direction from the <code>IssueInstant</code> of the message and the current Workday server time. Skew is the difference between the Workday server time and your IdP server time.</p>
</li>
</ul>
</li>
<li>
<p>In the Single Sign-on section, enter SAML redirect URLs.</p>
<ul>
<li>
<p>Redirect URLs must use HTTPS. You can:</p>
<ul>
<li>
<p>Select the Workday Environment to which these URLs apply. For each environment except Production, you can apply redirect URLs to preview tenants (select the Preview Only check box).</p>
<p>這裡的 preview 跟名為 preview 的 tenant 無關，但什麼是 preview??</p>
</li>
<li>
<p>Add more rows to set different redirect URLs for each environment.</p>
</li>
</ul>
</li>
</ul>
<p>實驗發現，尚未登入時會直接收到 302 轉向另一個 URL，跟 SAML message 無關，這跟 SP-initiated 是什麼關係??</p>
<p>As you complete the task, consider:</p>
<ul>
<li>
<p>Redirect Type</p>
<p>The login redirect, mobile app login redirect, and mobile browser login redirect URLs that Workday uses for SAML SSO.</p>
<ul>
<li>
<p>Single URL uses a single authentication option FOR ALL USERS. This option uses the 3 login redirect URLs configured in the adjacent cells of the Redirection URLs grid.</p>
</li>
<li>
<p>Authentication Selector uses the login redirect URLs configured on the selected authentication selector. Select this option if USER GROUPS from your organization use different authentication options to sign in. ??</p>
<p>If you select Authentication Selector, Workday builds a CUSTOM SIGN-IN PAGE for your tenant based on the authentication selector configuration.</p>
</li>
</ul>
<p>差別在於所有使用者要一體適用，還是要分群。</p>
</li>
<li>
<p>Login Redirect URL</p>
<p>(Single URL redirect type only) Enter this URL to redirect users for authentication: https://<workdayhost>/<tenantname>/login-saml2.htmld.</p>
</li>
<li>
<p>Logout Redirect URL</p>
<p>Enter the URL to redirect users to when they click the Sign Out button.</p>
</li>
<li>
<p>Timeout Redirect URL</p>
<p>Enter the URL to redirect users to when their Workday session times out. Typically, this URL is the same as the Logout Redirect URL.</p>
</li>
<li>
<p>Mobile App Login Redirect URL</p>
<p>(Optional - Single URL redirect type only) Enter this URL to redirect users to when they access Workday on iPad, iPhone, or Android: https://<workdayhost>/<tenantname>/login-saml2.htmld. If you don&rsquo;t enter a URL, Workday automatically redirects mobile users to the Sign In to Workday page.</p>
</li>
<li>
<p>Mobile Browser Login Redirect URL</p>
<p>(Optional - Single URL redirect type only) Enter this URL to redirect users to when they access Workday on a mobile browser: https://<workdayhost>/<tenantname>/login-saml2.htmld. If you don&rsquo;t enter a URL, Workday automatically redirects mobile users to the Sign In to Workday page.</p>
</li>
</ul>
</li>
</ol>
<p>Result</p>
<ul>
<li>Users can access Workday after successfully authenticating using your SAML provider.</li>
</ul>
<p>Next Steps</p>
<ul>
<li>
<p>Access the Signons and Attempted Signons report to monitor SAML authentication attempts during a specific time period.</p>
<p>在啟用 SSO 後的觀察很方便。</p>
</li>
</ul>
</li>
<li>
<p><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/MY3TeKRseKRfx_VFFi4olw">Generate SAML Metadata • Authentication and Security • Reader • Administrator Guide</a></p>
<p>Context</p>
<ul>
<li>
<p>Workday enables you to generate SAML metadata, so that SAML Service Providers that rely on Workday as a SAML Identity Provider for authentication can be easily configured.</p>
<p>Workday 自己也可以做為 IdP? Workday 做為公司的 ERP，直接當做 IdP 也是有可能。</p>
</li>
</ul>
<p>Steps</p>
<ul>
<li>
<p>From the related actions menu of a SAML SSO Link or Quicklink, select SAML SSO Link &gt; Generate Metadata. ??</p>
<p>注意這跟 <code>Generate Workday SAML Metadata</code> Task 無關，這是在產生 SP metadata &ndash; Workday 做為 SP 而非 IdP。</p>
</li>
</ul>
<p>Result</p>
<ul>
<li>
<p>This task returns the SAML metadata necessary for the configuration of a SAML Service Provider:</p>
<ul>
<li>SAML entity ID</li>
<li>SAML public key</li>
<li>URL (and the associated binding) to which unauthenticated user agents are sent</li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/_sMK~PTf2v9XEkiRpNfjJQ">Create or Edit SAML SSO Links • Authentication and Security • Reader • Administrator Guide</a> #ril</p>
<p>Prerequisites</p>
<ul>
<li>
<p>Configure these settings on the Edit Tenant Setup - Security task:</p>
<ul>
<li>x509 Private Key Pair, which Workday uses to sign the SAML Response sent to your SAML Identity Provider (IdP).</li>
<li>Service Provider ID, which Workday uses as the default Issuer ID in all SAML SSO links.</li>
</ul>
</li>
<li>
<p>Security: Set Up: Tenant Setup - Security domain in the System functional area.</p>
</li>
</ul>
<p>Context</p>
<ul>
<li>
<p>You can create and edit SAML SSO links that use Workday as a SAML IdP to SIGN IN TO OTHER SYSTEMS FROM WORKDAY. Depending on your link configuration, you can also pass contextual data to external systems. Workday supports both SAML 1.1 and SAML 2.0.</p>
<p>確實是把 Workday 當成 IdP 在用!!</p>
</li>
</ul>
</li>
<li>
<p><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/1SrUii41GTc5l3k14I02lA">Configure Identity Provider-Initiated SAML Authentication • Authentication and Security • Reader • Administrator Guide</a> #ril</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/workday-tutorial">Tutorial: Azure Active Directory single sign-on (SSO) integration with Workday | Microsoft Docs</a> (2019-08-20)</p>
<ul>
<li>
<p>In this tutorial, you&rsquo;ll learn how to integrate Workday with Azure Active Directory (Azure AD). When you integrate Workday with Azure AD, you can:</p>
<ul>
<li>
<p>Control in Azure AD WHO HAS ACCESS to Workday.</p>
<p>某種程度上的 authorization。</p>
</li>
<li>
<p>Enable your users to be automatically signed-in to Workday with their Azure AD accounts.</p>
</li>
<li>Manage your accounts in one central location - the Azure portal.</li>
</ul>
<p>有趣的是，過程完全沒用到 <code>Generate Workday SAML Metadata</code> Task。</p>
</li>
</ul>
<p>Prerequisites</p>
<ul>
<li>
<p>To get started, you need the following items:</p>
<ul>
<li>An Azure AD subscription. If you don&rsquo;t have a subscription, you can get a free account.</li>
<li>Workday single sign-on (SSO) enabled subscription.</li>
</ul>
<p>Subscription 是 AAD 這邊的說法?</p>
</li>
</ul>
<p>Scenario description</p>
<ul>
<li>In this tutorial, you configure and test Azure AD SSO in a test environment. Workday supports SP initiated SSO.</li>
</ul>
<p>Adding Workday from the gallery</p>
<ul>
<li>
<p>To configure the integration of Workday into Azure AD, you need to add Workday from the GALLERY to your list of managed SaaS apps.</p>
<ol>
<li>Sign in to the Azure portal using either a work or school account, or a personal Microsoft account.</li>
<li>On the left navigation pane, select the Azure Active Directory service.</li>
<li>Navigate to Enterprise Applications and then select All Applications.</li>
<li>To add new application, select New application.</li>
<li>In the Add from the gallery section, type Workday in the search box.</li>
<li>Select Workday from results panel and then add the app. Wait a few seconds while the app is added to your TENANT.</li>
</ol>
</li>
</ul>
<p>Configure and test Azure AD single sign-on for Workday</p>
<ul>
<li>
<p>Configure and test Azure AD SSO with Workday using a test user called B.Simon. For SSO to work, you need to establish a LINK RELATIONSHIP between an Azure AD user and the related user in Workday.</p>
<p>這個 link 每個 user 都要手動做??</p>
</li>
<li>
<p>To configure and test Azure AD SSO with Workday, complete the following building blocks:</p>
<ol>
<li>
<p>Configure Azure AD SSO to enable your users to use this feature.</p>
<ul>
<li>Create an Azure AD test user to test Azure AD single sign-on with B.Simon.</li>
<li>Assign the Azure AD test user to enable B.Simon to use Azure AD single sign-on.</li>
</ul>
<p>只是讓使用者可以用 SSO，但跟 Workday 沒有關係??</p>
</li>
<li>
<p>Configure Workday to configure the SSO settings on application side.</p>
<p>Create Workday test user to have a counterpart of B.Simon in Workday that is linked to the Azure AD representation of user.</p>
</li>
<li>
<p>Test SSO to verify whether the configuration works.</p>
</li>
</ol>
</li>
</ul>
<p>Configure Azure AD SSO</p>
<ul>
<li>
<p>Follow these steps to enable Azure AD SSO in the Azure portal.</p>
<ol>
<li>In the Azure portal, on the Workday application integration page, find the Manage section and select Single sign-on.</li>
<li>On the Select a Single sign-on method page, select SAML.</li>
<li>
<p>On the Set up Single Sign-On with SAML page, click the edit/pen icon for Basic SAML Configuration to edit the settings.</p>
</li>
<li>
<p>On the Basic SAML Configuration page, enter the values for the following fields:</p>
<ul>
<li>
<p>In the Sign-on URL text box, type a URL using the following pattern: <code>https://impl.workday.com/&lt;tenant&gt;/login-saml2.flex</code></p>
<p>結尾的 <code>.flex</code> 是誤植，應該是 <code>.htmld</code> ??</p>
</li>
<li>
<p>In the Identifier text box, type a URL using the following pattern: <code>http://www.workday.com</code></p>
</li>
<li>In the Reply URL text box, type a URL using the following pattern: <code>https://impl.workday.com/&lt;tenant&gt;/login-saml.htmld</code></li>
</ul>
<p>Note: These values are not the real. Update these values with the actual Sign-on URL and Reply URL. Your reply URL must have a subdomain for example: <code>www</code>, <code>wd2</code>, <code>wd3</code>, <code>wd3-impl</code>, <code>wd5</code>, <code>wd5-impl</code>). Using something like <code>http://www.myworkday.com</code> works but <code>http://myworkday.com</code> does not. Contact Workday Client support team to get these values. You can also refer to the patterns shown in the Basic SAML Configuration section in the Azure portal.</p>
<p>這些值到底在系統的哪裡查得到? 真的只能問客服??</p>
</li>
<li>
<p>Your Workday application expects the SAML ASSERTIONS in a specific format, which requires you to add CUSTOM ATTRIBUTE MAPPINGS to your SAML token attributes configuration.</p>
<p>The following screenshot shows the list of default attributes, where as <code>name</code> identifier is mapped with <code>user.userprincipalname</code>. Workday application expects <code>name</code> identifier to be mapped with <code>user.mail</code>, UPN, etc., so you need to edit the attribute mapping by clicking on Edit icon and change the attribute mapping.</p>
<p><img alt="" src="https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/common/edit-attribute.png" /></p>
<p>Note: Here we have mapped the Name ID with UPN (<code>user.userprincipalname</code>) as default. You need to map the Name ID with actual User ID in your Workday account (your email, UPN, etc.) for successful working of SSO.</p>
<p>因為 Workday 預期 <code>name</code> 是 email，所以要確認 UPN 是不是 email ??</p>
</li>
<li>
<p>On the Set up Single Sign-On with SAML page, in the SAML Signing Certificate section, find Certificate (Base64) and select Download to download the certificate and save it on your computer.</p>
<p>這就是 IdP 的 public key，交給 SP 驗證 ??</p>
</li>
<li>
<p>To modify the Signing options as per your requirement, click Edit button to open SAML Signing Certificate dialog.</p>
<p><img alt="" src="https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/media/workday-tutorial/signing-option.png" /></p>
<p>畫面上有 Signing Option: Sign SAML response and assertion 及 Signing Algorithm: SHA-256。</p>
</li>
<li>
<p>On the Set up Workday section, copy the appropriate URL(s) based on your requirement.</p>
<p><img alt="" src="https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/common/copy-configuration-urls.png" /></p>
<p>畫面上有：</p>
<ul>
<li>Login URL &ndash; 除做為 Redirection URLs 下的 Login/Redirect/Mobile Redirect URL，也做為 SAML Identity Providers 下的 IdP SSO Service URL。</li>
<li>Azure AD Identifier &ndash; 做為 SAML Identity Providers 下的 Issuer</li>
<li>Logout URL &ndash; 除做為 Redirection URLs 下的 Logout Redirect URL，也做為 SAML Identity Providers 下的 Logout Response URL。</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>Create an Azure AD test user</p>
<ul>
<li>
<p>In this section, you&rsquo;ll create a test user in the Azure portal called B.Simon.</p>
<ol>
<li>From the left pane in the Azure portal, select Azure Active Directory, select Users, and then select All users.</li>
<li>Select New user at the top of the screen.</li>
<li>
<p>In the User properties, follow these steps:</p>
<ul>
<li>In the Name field, enter <code>B.Simon</code>.</li>
<li>In the User name field, enter the <code>username@companydomain.extension</code>. For example, <code>B.Simon@contoso.com</code>.</li>
<li>Select the Show password check box, and then write down the value that&rsquo;s displayed in the Password box.</li>
<li>Click Create.</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>Assign the Azure AD test user</p>
<ul>
<li>
<p>In this section, you&rsquo;ll enable B.Simon to use Azure single sign-on by granting access to Workday.</p>
<ol>
<li>In the Azure portal, select Enterprise Applications, and then select All applications.</li>
<li>In the applications list, select Workday.</li>
<li>In the app&rsquo;s overview page, find the Manage section and select Users and groups.</li>
<li>Select Add user, then select Users and groups in the Add Assignment dialog.</li>
<li>
<p>In the Users and groups dialog, select B.Simon from the Users list, then click the Select button at the bottom of the screen.</p>
</li>
<li>
<p>If you&rsquo;re expecting any ROLE VALUE in the SAML assertion, in the Select Role dialog, select the appropriate role for the user from the list and then click the Select button at the bottom of the screen.</p>
<p>這跟 Workday 的 Organization Role 是什麼關係 ??</p>
</li>
<li>
<p>In the Add Assignment dialog, click the Assign button.</p>
</li>
</ol>
</li>
</ul>
<p>Configure Workday</p>
<ol>
<li>In a different web browser window, sign in to your Workday company site as an administrator.</li>
<li>
<p>In the Search box search with the name <code>Edit Tenant Setup – Security</code> on the top left side of the home page.</p>
</li>
<li>
<p>In the Redirection URLs section, perform the following steps:</p>
<ul>
<li>Click Add Row.</li>
<li>In the Login Redirect URL, Timeout Redirect URL and Mobile Redirect URL textbox, paste the Login URL which you have copied from the Set up Workday section of Azure portal.</li>
<li>In the Logout Redirect URL textbox, paste the Logout URL which you have copied from the Set up Workday section of Azure portal.</li>
<li>In Used for Environments textbox, select the environment name.</li>
</ul>
<p>Note: The value of the Environment attribute is tied to the value of the tenant URL:</p>
<ul>
<li>
<p>If the domain name of the Workday tenant URL starts with <code>impl</code> for example: <a href="https://impl.workday.com/">https://impl.workday.com/</a><tenant>/login-saml2.flex), the Environment attribute must be set to Implementation.</p>
<p>但為什麼 <code>wd3-impl.workday.com/...</code> 是 Sandbox ??</p>
</li>
<li>
<p>If the domain name starts with something else, you need to contact Workday Client support team to get the matching Environment value.</p>
</li>
</ul>
</li>
<li>
<p>In the SAML Setup section, perform the following steps:</p>
<ul>
<li>Select Enable SAML Authentication.</li>
<li>Click Add Row.</li>
</ul>
</li>
<li>
<p>In the SAML Identity Providers section, perform the following steps:</p>
<ul>
<li>
<p>In the Identity Provider Name textbox, type a provider name (for example: <code>SPInitiatedSSO</code>).</p>
<p>為什麼一直強調 SP-initiated ??</p>
</li>
<li>
<p>In the Azure portal, on the Set up Workday section, copy the Azure AD Identifier value, and then paste it into the Issuer textbox.</p>
</li>
<li>In the Azure portal, on the Set up Workday section, copy the Logout URL value, and then paste it into the Logout Response URL textbox.</li>
<li>In the Azure portal, on the Set up Workday section, copy the Login URL value, and then paste it into the IdP SSO Service URL textbox.</li>
<li>In Used for Environments textbox, select the environment name.</li>
<li>Click Identity Provider Public Key Certificate, and then click Create.</li>
<li>Click Create x509 Public Key.</li>
</ul>
</li>
<li>
<p>In the View x509 Public Key section, perform the following steps:</p>
<ul>
<li>
<p>In the Name textbox, type a name for your certificate (for example: <code>PPE_SP</code>).</p>
</li>
<li>
<p>In the Valid From textbox, type the valid from attribute value of your certificate.</p>
</li>
<li>
<p>In the Valid To textbox, type the valid to attribute value of your certificate.</p>
<p>Note: You can get the valid from date and the valid to date from the downloaded certificate by double-clicking it. The dates are listed under the Details tab.</p>
</li>
<li>
<p>Open your base-64 encoded certificate in notepad, and then copy the content of it.</p>
</li>
<li>In the Certificate textbox, paste the content of your clipboard.</li>
<li>Click OK.</li>
</ul>
<p>建立 IdP 提供的 public key ?? 如果是這樣，valid from/to 為何要手動提供?</p>
</li>
<li>
<p>Perform the following steps:</p>
<ul>
<li>
<p>In the Service Provider ID textbox, type <code>http://www.workday.com</code>.</p>
<p>跟 AAD 上 Basic SAML Configuration 的 Identifier 對應。</p>
</li>
<li>
<p>Select Do Not Deflate SP-initiated Authentication Request. ??</p>
</li>
<li>As Authentication Request Signature Method, select SHA256.</li>
<li>Click OK.</li>
</ul>
<p>Note: Please ensure you set up single sign-on correctly. In case you enable single sign-on with incorrect setup, you may not be able to enter the application with your credentials and get LOCKED OUT. In this situation, Workday provides a BACKUP LOG-IN URL where users can sign-in using their normal username and password in the following format: <code>[Your Workday URL]/login.flex?redirect=n</code></p>
</li>
</ol>
<p>Create Workday test user</p>
<ul>
<li>In this section, you create a user called B.Simon in Workday. Work with Workday Client support team to add the users in the Workday platform. Users must be created and activated before you use single sign-on.</li>
</ul>
<p>Test SSO</p>
<ul>
<li>When you select the Workday TILE in the Access Panel, you should be automatically signed in to the Workday for which you set up SSO. For more information about the Access Panel, see Introduction to the Access Panel.</li>
</ul>
</li>
</ul>
<h2 id="reference">參考資料<a class="headerlink" href="#reference" title="Permanent link"> #</a></h2>
<p>文件：</p>
<ul>
<li><a href="https://doc.workday.com/reader/Z9lz_01hqDMDg6NSf7wCBQ/xeLJBYTXe1Lh2_tVXobgLA">Authentication - Administrator Guide</a></li>
</ul></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        
        
    </footer>

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <!-- <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script> -->
    <script src="../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
