<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="https://imsardine.github.io/dev-notes/jinja-template/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>Jinja / Template - 建造以學習 | 在電梯裡遇見雙胞胎</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/3.003/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.min.css">
    <link href="../cinder_extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">建造以學習 | 在電梯裡遇見雙胞胎</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/imsardine/dev-notes/blob/source/docs/jinja-template.md">Edit on imsardine/dev-notes</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#jinja-template">Jinja / Template</a></li>
            <li class="second-level"><a href="#variable">Variable ??</a></li>
                
            <li class="second-level"><a href="#filter">Filter ??</a></li>
                
            <li class="second-level"><a href="#test">Test ??</a></li>
                
            <li class="second-level"><a href="#inheritance">Inheritance ??</a></li>
                
            <li class="second-level"><a href="#macro">Macro ??</a></li>
                
            <li class="second-level"><a href="#less-logic-in-template">Template 裡不該有邏輯 ??</a></li>
                
            <li class="second-level"><a href="#reference">參考資料</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="jinja-template"><a href="../jinja/">Jinja</a> / Template<a class="headerlink" href="#jinja-template" title="Permanent link"> #</a></h1>
<ul>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/templates/">Template Designer Documentation — Jinja2 Documentation (2.10)</a> #ril</p>
<ul>
<li>
<p>This document describes the syntax and semantics of the template engine and will be most useful as reference to those creating Jinja templates. As the template engine is very flexible, the configuration from the application can be slightly different from the code presented here in terms of delimiters and behavior of undefined values.</p>
<p>因為 Jinja 強調 configurable，所以行為上會因 environment 的設定而異。</p>
</li>
</ul>
<p>Synopsis</p>
<ul>
<li>
<p>A Jinja template is simply a text file. Jinja can generate ANY TEXT-BASED FORMAT (HTML, XML, CSV, LaTeX, etc.). A Jinja template doesn’t need to have a specific extension: <code>.html</code>, <code>.xml</code>, or any other extension is just fine.</p>
<p><a href="https://stackoverflow.com/questions/29590931/">python - Is there an idiomatic file extension for Jinja templates? - Stack Overflow</a> 多數人同意 Ansible 採 <code>.j2</code> 的做法。</p>
</li>
<li>
<p>A template contains VARIABLES and/or EXPRESSIONS, which get replaced with values when a template is RENDERED; and TAGS, which control the LOGIC of the template. The template syntax is heavily inspired by Django and Python.</p>
<p>注意 delimiter 與 tag 的不同，delimiter 指的是 <code>{% ... %}</code>、<code>{{ ... }}</code> 這些從 template 挖洞安插動態資料的部份，而 tag 則是指 <code>{% ... %}</code> 裡特有的 template language，例如 <code>for</code>、<code>include</code> 等。</p>
</li>
<li>
<p>Below is a minimal template that illustrates a few basics using the default Jinja configuration. We will cover the details later in this document:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;title&gt;My Webpage&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;ul id="navigation"&gt;
    {% for item in navigation %}
        &lt;li&gt;&lt;a href="{{ item.href }}"&gt;{{ item.caption }}&lt;/a&gt;&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;

    &lt;h1&gt;My Webpage&lt;/h1&gt;
    {{ a_variable }}

    {# a comment #}
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
</li>
<li>
<p>The following example shows the default configuration settings. An application developer can change the syntax configuration from <code>{% foo %}</code> to <code>&lt;% foo %&gt;</code>, or something similar.</p>
<p>There are a few kinds of DELIMITERS. The default Jinja delimiters are configured as follows:</p>
<ul>
<li><code>{% ... %}</code> for Statements</li>
<li><code>{{ ... }}</code> for Expressions to print to the template output</li>
<li><code>{# ... #}</code> for Comments not included in the template output</li>
<li><code>#  ... ##</code> for Line Statements</li>
</ul>
<p>原來有這麼多用法!! 最後一個 line statement 的應用情境 ??</p>
</li>
</ul>
<p>Comments</p>
<ul>
<li>
<p>To comment-out part of a line in a template, use the comment syntax which is by default set to <code>{# ... #}</code>. This is useful to comment out parts of the template FOR DEBUGGING or to add information for other template designers or yourself:</p>
<pre><code>{# note: commented-out template because we no longer use this
    {% for user in users %}
        ...
    {% endfor %}
#}
</code></pre>
<p>可以包含其他 delimiter。</p>
</li>
</ul>
<p>Whitespace Control</p>
<ul>
<li>
<p>In the default configuration:</p>
<ul>
<li>
<p>a single trailing newline is stripped if present</p>
<p>實驗確認，這裡的 single trailing newline 指的是整個 template 的結尾，而非某個 block 的結尾處；符合 <a href="http://jinja.pocoo.org/docs/2.10/api/#high-level-api"><code>jinja2.Environment</code></a> 中 <code>keep_trailing_newline</code> option 的說法：</p>
<blockquote>
<p>Preserve the trailing newline when rendering templates. The default is <code>False</code>, which causes a single newline, if present, to be stripped from THE END OF THE TEMPLATE.</p>
</blockquote>
</li>
<li>
<p>other whitespace (spaces, tabs, newlines etc.) is returned unchanged</p>
</li>
</ul>
</li>
<li>
<p>If an application configures Jinja to <code>trim_blocks</code>, the FIRST newline after a template tag is removed automatically (like in PHP). The <code>lstrip_blocks</code> option can also be set to strip tabs and spaces from the beginning of a line to the start of a block. (Nothing will be stripped if there are other characters before the start of the block.)</p>
<p>這裡 block 好像不是專指 {% block %}<code _="%" class="..">而是泛指</code><code _="%">? 實驗發現 "first newline after a template tag" 只會刪</code><code True="True" _="%" if="if">後面遇到的第一個 newline，但其他 whitespace 不會動，例如</code>\n\t<code>會留下</code>\t<code True="True" _="%" if="if">，但</code>\t\n<code>則會留下</code>\t\n<code>，因為後者的</code>\n<code>沒有緊貼著</code>%}`。</p>
<p>With both <code>trim_blocks</code> and <code>lstrip_blocks</code> enabled, you can put BLOCK TAGS on their own lines, and the entire BLOCK LINE will be removed when rendered, preserving the whitespace of the contents. For example, without the <code>trim_blocks</code> and <code>lstrip_blocks</code> options, this template:</p>
<pre><code>&lt;div&gt;
    {% if True %}
        yay
    {% endif %}
&lt;/div&gt;
</code></pre>
<p>gets rendered with blank lines inside the div:</p>
<pre><code>&lt;div&gt;

        yay

&lt;/div&gt;
</code></pre>
<p>But with both <code>trim_blocks</code> and <code>lstrip_blocks</code> enabled, the template block lines are removed and other whitespace is preserved:</p>
<pre><code>&lt;div&gt;
        yay
&lt;/div&gt;
</code></pre>
<p>就如同那些 block tags 不曾存在過一樣。</p>
</li>
<li>
<p>You can manually disable the <code>lstrip_blocks</code> behavior by putting a plus sign (<code>+</code>) at the start of a block:</p>
<pre><code>&lt;div&gt;
        {%+ if something %}yay{% endif %}
&lt;/div&gt;
</code></pre>
</li>
<li>
<p>You can also strip whitespace in templates BY HAND. If you add a minus sign (<code>-</code>) to the start or end of a block (e.g. a For tag), a comment, or a variable expression, the whitespaces before or after that block will be removed:</p>
<pre><code>{% for item in seq -%}
    {{ item }}
{%- endfor %}
</code></pre>
<p>This will yield all elements without whitespace between them. If <code>seq</code> was a list of numbers from 1 to 9, the output would be <code>123456789</code>.</p>
<p>沒想到 variable expression (<code>{{ ... }}</code>) 的用法跟 whitespace 的去留也有關 ?? 實驗發現，這裡 by hand 的做法效果不等同於上面的 <code>trim_blocks</code> + <code>lstrip_blocks</code>，因為 <code>{%-</code> 或 <code>-%}</code> 會將鄰近其他行的 whitespace 也刪掉，有時候很難達到 &ldquo;you can put block tags on their own lines&rdquo; 的效果。</p>
</li>
<li>
<p>If Line Statements are enabled, they strip leading whitespace automatically up to the beginning of the line. ??</p>
</li>
<li>
<p>By default, Jinja2 also removes trailing newlines. To keep single trailing newlines, configure Jinja to <code>keep_trailing_newline</code>.</p>
</li>
<li>
<p>Note: You must NOT add whitespace between the tag and the minus sign.</p>
<p>valid:</p>
<pre><code>{%- if foo -%}...{% endif %}
</code></pre>
<p>invalid:</p>
<pre><code>{% - if foo - %}...{% endif %}
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="variable">Variable ??<a class="headerlink" href="#variable" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/templates/#variables">Variables - Template Designer Documentation — Jinja2 Documentation (2.10)</a></p>
<ul>
<li>
<p>Template variables are defined by the CONTEXT DICTIONARY passed to the template.</p>
</li>
<li>
<p>You can MESS AROUND with the variables in templates provided they are passed in by the application. Variables may have attributes or elements on them you can access too. What attributes a variable has depends heavily on the application providing that variable.</p>
<p>You can use a dot (<code>.</code>) to access attributes of a variable in addition to the standard Python <code>__getitem__</code> “subscript” syntax (<code>[]</code>). The following lines do the same thing:</p>
<pre><code>{{ foo.bar }}
{{ foo['bar'] }}
</code></pre>
</li>
<li>
<p>It’s important to know that the outer double-curly braces are not part of the variable, but the PRINT STATEMENT. If you access variables inside tags don’t put the braces around them.</p>
<p>原來 <code>{{ ... }}</code> expression 等同於 print statement。</p>
</li>
<li>
<p>If a variable or attribute DOES NOT EXIST, you will get back an UNDEFINED VALUE. What you can do with that kind of value depends on the application configuration: the default behavior is to evaluate to an EMPTY STRING if printed OR ITERATED OVER, and to fail for every other operation.</p>
<p>看似滿貼心的設計，但默默地吃掉錯誤，更難發現 template 本身的問題? 還好只有 print 與 iteration 時。</p>
</li>
</ul>
<p>Implementation</p>
<ul>
<li>
<p>For the sake of convenience, <code>foo.bar</code> in Jinja2 does the following things on the Python layer:</p>
<ul>
<li>check for an attribute called <code>bar</code> on <code>foo</code> (<code>getattr(foo, 'bar')</code>)</li>
<li>if there is not, check for an item <code>'bar'</code> in <code>foo</code> (<code>foo.__getitem__('bar')</code>)</li>
<li>if there is not, return an undefined object.</li>
</ul>
</li>
<li>
<p>foo[&lsquo;bar&rsquo;] works mostly the same with a small difference in sequence:</p>
<ul>
<li>check for an item <code>'bar'</code> in <code>foo</code>. (<code>foo.__getitem__('bar')</code>)</li>
<li>if there is not, check for an attribute called <code>bar</code> on <code>foo</code>. (<code>getattr(foo, 'bar')</code>)</li>
<li>if there is not, return an undefined object.</li>
</ul>
<p>This is important if an object has an item and attribute with the same name. Additionally, the <code>attr()</code> filter only looks up attributes.</p>
<p>也因此 <code>foo.bar</code> 與 <code>foo['bar']</code> 的用法是相通，差別只在先檢查 attribute 或 item。</p>
</li>
</ul>
</li>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/api/#notes-on-identifiers">Notes on Identifiers - API — Jinja2 Documentation (2.10)</a> #ril</p>
</li>
<li><a href="http://jinja.pocoo.org/docs/2.10/api/#the-global-namespace">The Global Namespace - API — Jinja2 Documentation (2.10)</a> #ril</li>
</ul>
<h2 id="filter">Filter ??<a class="headerlink" href="#filter" title="Permanent link"> #</a></h2>
<ul>
<li><code>int()</code> 屬於 builtin filter 而非 builtin global function，結果 <code>{% for page in range(int(cookiecutter.number_of_slides)) %}</code> 會出現 <code>int not defined</code> 的錯誤，非得用 <code>{% set number_of_slides = cookiecutter.number_of_slides | int %}</code> 先轉換過?</li>
</ul>
<hr />
<p>參考資料：</p>
<ul>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/templates/#filters">Filters - Template Designer Documentation — Jinja2 Documentation (2.10)</a></p>
<ul>
<li>
<p>Variables can be modified by filters. Filters are separated from the variable by a pipe symbol (<code>|</code>) and may have OPTIONAL ARGUMENTS in parentheses. Multiple filters can be CHAINED. The output of one filter is applied to the next.</p>
<p>For example, <code>{{ name|striptags|title }}</code> will remove all HTML Tags from variable name and title-case the output (<code>title(striptags(name))</code>).</p>
</li>
<li>
<p>Filters that accept arguments have parentheses around the arguments, just like a function call. For example: <code>{{ listx|join(', ') }}</code> will join a list with commas (<code>str.join(', ', listx)</code>).</p>
</li>
</ul>
</li>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/api/#custom-filters">Custom Filters - API — Jinja2 Documentation (2.10)</a> #ril</p>
</li>
</ul>
<h2 id="test">Test ??<a class="headerlink" href="#test" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/templates/#tests">Tests - Template Designer Documentation — Jinja2 Documentation (2.10)</a></p>
<ul>
<li>
<p>Beside filters, there are also so-called “tests” available. Tests can be used to test a variable AGAINST A COMMON EXPRESSION.</p>
<p>To test a variable or expression, you add <code>is</code> plus the NAME OF THE TEST after the variable. For example, to find out if a variable is DEFINED, you can do <code>name is defined</code>, which will then return true or false depending on whether name is defined in the current template context.</p>
<p>除了固定用 <code>is</code> 接判斷，通常會搭配 <code>if</code> tag。</p>
</li>
<li>
<p>Tests can accept arguments, too. If the test only takes one argument, you can leave out the parentheses. For example, the following two expressions do the same thing:</p>
<pre><code>{% if loop.index is divisibleby 3 %}
{% if loop.index is divisibleby(3) %}
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="inheritance">Inheritance ??<a class="headerlink" href="#inheritance" title="Permanent link"> #</a></h2>
<ul>
<li><a href="http://jinja.pocoo.org/docs/2.10/templates/#template-inheritance">Inheritance - Template Designer Documentation — Jinja2 Documentation (2.10)</a> #ril</li>
</ul>
<h2 id="macro">Macro ??<a class="headerlink" href="#macro" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/templates/#macros">Macros - Template Designer Documentation — Jinja2 Documentation (2.10)</a></p>
<ul>
<li>
<p>Macro 就像是一般程式語言的 function，可以把慣用寫法 (idiom) 包裝成 reusable function (DRY)。例如：</p>
<pre><code>{% macro input(name, value='', type='text', size=20) -%}
    &lt;input type="{{ type }}" name="{{ name }}" value="{{
        value|e }}" size="{{ size }}"&gt;
{%- endmacro %}
</code></pre>
</li>
<li>
<p>用起來就像 function call 一樣 (in the namespace??)；看起來像 Python code，但其實不是。</p>
<pre><code>&lt;p&gt;{{ input('username') }}&lt;/p&gt;
&lt;p&gt;{{ input('password', type='password') }}&lt;/p&gt;
</code></pre>
</li>
<li>
<p>在 macro 裡，除了 macro 宣告的參數之外，還有些 special variables 可以調用： #ril</p>
<ul>
<li><code>varargs</code> (<code>list</code>) - 內有多出來的 (unconsumed) positional arguments。</li>
<li><code>kwargs</code> (<code>dict</code>) - 內有多出來的 (unconsumed) keyword arguments。</li>
</ul>
</li>
<li>
<p>如果 macro name 以底線開頭，就不能被 export &amp; import；只能在單一個 template 裡使用。</p>
</li>
</ul>
</li>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/faq/#my-macros-are-overridden-by-something">My Macros are overridden by something - Frequently Asked Questions — Jinja2 Documentation (2.10)</a> #ril</p>
</li>
</ul>
<h2 id="less-logic-in-template">Template 裡不該有邏輯 ??<a class="headerlink" href="#less-logic-in-template" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="http://jinja.pocoo.org/docs/2.10/faq/#isn-t-it-a-terrible-idea-to-put-logic-into-templates">Isn’t it a terrible idea to put Logic into Templates? - Frequently Asked Questions — Jinja2 Documentation (2.10)</a></p>
<ul>
<li>Without a doubt you should try to remove as much logic from templates as possible. 大方向是，但並非絕對。</li>
<li>But templates without any logic mean that you have to do all the processing in the code which is boring and stupid. So some amount of logic is required in templates to KEEP EVERYONE HAPPY. Python 內建的 <a href="https://docs.python.org/3/library/string.html#string.Template"><code>string.Template</code></a> 就不支援 loop、if condition，在 developer 與 designer 間要取得一個平衡。</li>
<li>Jinja leaves it pretty much to you how much logic you want to put into templates. There are some restrictions in what you can do and what not. 自己決定要放多少 logic 進 template，但 Jinja 本身還是有限制，例如只允許少數的 Python expression (只是 template language 長得像而已?)，目的還是要讓 template 好維護、容易閱讀。</li>
</ul>
</li>
</ul>
<h2 id="reference">參考資料<a class="headerlink" href="#reference" title="Permanent link"> #</a></h2>
<p>手冊：</p>
<ul>
<li><a href="http://jinja.pocoo.org/docs/2.10/templates/#builtin-filters">List of Builtin Filters</a></li>
<li><a href="http://jinja.pocoo.org/docs/2.10/templates/#builtin-tests">List of Builtin Tests</a></li>
</ul></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        
        
    </footer>

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <!-- <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script> -->
    <script src="../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
