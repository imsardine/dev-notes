<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="https://imsardine.github.io/dev-notes/aws-sns/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>AWS / SNS (Simple Notification Service) - 建造以學習 | 在電梯裡遇見雙胞胎</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/3.003/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.min.css">
    <link href="../cinder_extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">建造以學習 | 在電梯裡遇見雙胞胎</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/imsardine/dev-notes/blob/source/docs/aws-sns.md">Edit on imsardine/dev-notes</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#aws-sns-simple-notification-service">AWS / SNS (Simple Notification Service)</a></li>
            <li class="second-level"><a href="#getting-started">新手上路</a></li>
                
            <li class="second-level"><a href="#large-payload">Large Payload</a></li>
                
            <li class="second-level"><a href="#raw-message-delivery">Raw Message Delivery</a></li>
                
            <li class="second-level"><a href="#troubleshooting">疑難排解</a></li>
                
                <li class="third-level"><a href="#fifo-sqs-queues-can-not-be-subscribed-to-standard-sns-topics">FIFO SQS Queues can not be subscribed to standard SNS topics</a></li>
            <li class="second-level"><a href="#setup">安裝設置</a></li>
                
            <li class="second-level"><a href="#reference">參考資料</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="aws-sns-simple-notification-service"><a href="../aws/">AWS</a> / SNS (Simple Notification Service)<a class="headerlink" href="#aws-sns-simple-notification-service" title="Permanent link"> #</a></h1>
<ul>
<li>
<p><a href="https://aws.amazon.com/sns/">Amazon Simple Notification Service (SNS) | AWS</a></p>
<ul>
<li>
<p>Fully managed pub/sub messaging for microservices, distributed systems, and serverless applications</p>
</li>
<li>
<p>Amazon Simple Notification Service (SNS) is a highly available, durable, secure, fully managed pub/sub messaging service that enables you to decouple microservices, distributed systems, and serverless applications.</p>
<p>Amazon SNS provides topics for high-throughput, PUSH-BASED ??, many-to-many messaging. Using Amazon SNS topics, your publisher systems can FAN OUT messages to a large number of SUBSCRIBER ENDPOINTS for parallel processing, including Amazon SQS queues, AWS Lambda functions, and HTTP/S webhooks.</p>
<p>Additionally, SNS can be used to fan out notifications to END USERS using mobile push, SMS, and email.</p>
<p>感覺像是 AWS 提供不少現成的 application 做為 subscriber，從 topic 收到通知時，就執行特定的功能 &ndash; 往 SQS 塞資料、觸發 Lambda function、打 webhook、送 mobile push、SMS、email 等。</p>
<p>所謂 subscriber/subscribing endpoint 是指 SNS 收到 message 後要往哪裡送，下面 Getting Started 用的 endpoint type 是 Email，這時 endpoint 就是 email。</p>
</li>
</ul>
<p>Benefits</p>
<ul>
<li>
<p>Reliably deliver messages with durability</p>
<p>Amazon SNS uses CROSS AVAILABILITY ZONE message storage to provide high message durability. Running within Amazon’s proven network infrastructure and datacenters, Amazon SNS topics are available whenever your applications need them. All messages published to Amazon SNS are stored redundantly across multiple geographically separated servers and data centers.</p>
<p>Amazon SNS reliably delivers messages to all VALID AWS endpoints, such as Amazon SQS queues and AWS Lambda functions.</p>
</li>
<li>
<p>Automatically scale your workload</p>
<p>Amazon SNS leverages the proven AWS cloud to dynamically scale with your application. Amazon SNS is a fully managed service, taking care of the heavy lifting related to capacity planning, provisioning, monitoring, and patching. The service is designed to handle high-throughput, BURSTY TRAFFIC patterns. Moreover, there is no upfront cost, and no need to acquire, install, configure, or upgrade messaging software.</p>
</li>
<li>
<p>Simplify your architecture with Message Filtering</p>
<p>Amazon SNS helps you simplify your pub/sub messaging architecture by offloading the message filtering logic from your subscriber systems, and message routing logic from your publisher systems.</p>
<p>With Amazon SNS message filtering, subscribing endpoints receive only the messages of interest, instead of all messages published to the topic. Amazon CloudWatch gives visibility into your filtering activity, and AWS CloudFormation enables you to deploy SUBSCRIPTION FILTER POLICIES in an automated and secure manner.</p>
</li>
<li>
<p>Keep messages private and secure</p>
<p>Amazon SNS topic owners can keep sensitive data secure by setting topic policies that restrict who can publish and subscribe to a topic.</p>
<p>Amazon SNS also ensures that data is encrypted in transit by applying Amazon ATS certificates to support its HTTPS API, and can also encrypt data at rest by using AWS KMS keys. #ril</p>
<p>Additionally, using AWS PrivateLink, you can privately publish messages to Amazon SNS topics from your Amazon VPC subnets without traversing the public Internet.</p>
<p>Amazon SNS can also support use cases in regulated markets, and is in-scope with compliance programs, including HIPAA, PCI, ISO, FIPS, SOC and FedRAMP.</p>
</li>
</ul>
<p>How it works</p>
<ul>
<li>
<p>Amazon SNS enables message filtering and fanout to a large number of subscribers, including serverless functions, queues, and distributed systems. Additionally, Amazon SNS fans out notifications to end users via mobile push messages, SMS, and email.</p>
<p><img alt="" src="https://d1.awsstatic.com/product-marketing/SNS/product-page-diagram_SNS_how-it-works_1.53a464980bf0d5a868b141e9a8b2acf12abc503f.png" /></p>
</li>
</ul>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/sns-common-scenarios.html#SNSFanoutScenario">Fanout - Common Amazon SNS Scenarios - Amazon Simple Notification Service</a> #ril</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/welcome.html">What is Amazon Simple Notification Service? - Amazon Simple Notification Service</a></p>
<ul>
<li>
<p>Amazon Simple Notification Service (Amazon SNS) is a web service that COORDINATES and manages the delivery or sending of messages to subscribing endpoints or clients.</p>
<p>In Amazon SNS, there are two types of clients—publishers and subscribers—also referred to as producers and consumers. Publishers communicate asynchronously with subscribers by producing and sending a message to a topic, which is a LOGICAL ACCESS POINT and COMMUNICATION CHANNEL.</p>
<p>Subscribers (that is, web servers, email addresses, Amazon SQS queues, AWS Lambda functions) consume or receive the message or notification over one of the SUPPORTED PROTOCOLS (that is, Amazon SQS, HTTP/S, email, SMS, Lambda) when they are subscribed to the topic.</p>
<p><img alt="" src="https://docs.aws.amazon.com/sns/latest/dg/images/sns-how-works.png" /></p>
<p>為什麼文件極少提到自己的 application 往 topic 註冊為 subscriber ?? 其中 HTTP/S 最沒意義? 若要做到 decoupling，就不應假設 subscriber 活著?</p>
</li>
<li>
<p>When using Amazon SNS, you (as the owner) create a topic and control access to it by defining policies that determine which publishers and subscribers can communicate with the topic.</p>
<p>A publisher sends messages to topics that they have created or to topics they have permission to publish to. Instead of including a specific destination address in each message, a publisher sends a message to the topic. Amazon SNS MATCHES the topic to a list of subscribers who have subscribed to that topic, and delivers the message to each of those subscribers.</p>
<p>Each topic has a unique name that identifies the Amazon SNS endpoint for publishers to post messages and subscribers to register for notifications. Subscribers receive all messages published to the topics to which they subscribe, and all subscribers to a topic receive the same messages.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://aws.amazon.com/blogs/compute/building-scalable-applications-and-microservices-adding-messaging-to-your-toolbox/">Building Scalable Applications and Microservices: Adding Messaging to Your Toolbox | AWS Compute Blog</a> (2017-05-31) #ril</p>
</li>
</ul>
<h2 id="getting-started">新手上路<a class="headerlink" href="#getting-started" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="https://aws.amazon.com/sns/getting-started/">Amazon Simple Notification Service (SNS) Getting Started – AWS</a> #ril</p>
<p>Step 1: Create a Topic</p>
<ul>
<li>
<p>Sign in to the Amazon SNS console.</p>
</li>
<li>
<p>In the Create topic section, enter a Topic name, for example <code>MyTopic</code>.</p>
<p>左側選單打開選 Topics，按 Create topic 後，在 Name 填上 <code>MyTopic</code> 即可。</p>
</li>
<li>
<p>Choose Create topic.</p>
<p>The topic is created and the <code>MyTopic</code> page is displayed.</p>
<p>The topic&rsquo;s Name, ARN, (optional) Display name, and Topic owner&rsquo;s AWS account ID are displayed in the Details section.</p>
<p>其中 AWS account ID 應該就是畫面上的 Topic owner?</p>
</li>
<li>
<p>Copy the topic ARN to the clipboard, for example:</p>
<pre><code>arn:aws:sns:us-east-2:123456789012:MyTopic
</code></pre>
</li>
</ul>
<p>Step 2: Create a Subscription for an Endpoint to the Topic</p>
<ul>
<li>
<p>On the navigation panel, choose Subscriptions.</p>
</li>
<li>
<p>On the Subscriptions page, choose Create subscription.</p>
</li>
<li>
<p>On the Create subscription page, do the following:</p>
<ul>
<li>
<p>Enter the Topic ARN of the topic you created earlier, for example:</p>
<pre><code>arn:aws:sns:us-east-2:123456789012:MyTopic
</code></pre>
<p>Note: To see a list of the topics in the current AWS account, choose the Topic ARN field.</p>
<p>點下去就會出現下接提示，但不同 IAM user 的 topic 不互通嗎 ??</p>
</li>
</ul>
</li>
<li>
<p>For Protocol, choose an endpoint type, for example Email.</p>
<p>選項有 HTTP、HTTPS、Email、Email-JSON、Amazon SQS、AWS Lambda、Platform application endpoint 跟 SMS，如果是自己的 application 要接，要選什麼? 還是都要先進 queue ??</p>
</li>
<li>
<p>For Endpoint, enter an email address that can receive notifications, for example:</p>
<pre><code>name@example.com
</code></pre>
<p>Note: After your subscription is created, you must confirm it. Only HTTP/S endpoints, email addresses, and AWS resources in other AWS accounts require confirmation. (Amazon SQS queues and Lambda functions in the same AWS account—as well as mobile endpoints —don&rsquo;t require confirmation.) ??</p>
<p>一開始 subscription 的狀態是 Pending confirmation，會在上面提供的 email address 收到一封抬頭為 AWS Notification - Subscription Confirmation 的信件，內容為：</p>
<pre><code>You have chosen to subscribe to the topic:
arn:aws:sns:us-east-2:123456789012:MyTopic

To confirm this subscription, click or visit the link below (If this was in error no action is necessary):
Confirm subscription
</code></pre>
<p>按下 Confirm subscription 的連結，會看到：</p>
<pre><code>Subscription confirmed!
You have subscribed name@example.com to the topic:
MyTopic.

Your subscription's id is:
arn:aws:sns:us-east-2:123456789012:MyTopic:af18d595-2d2e-4911-a115-5561caec52a5

If it was not your intention to subscribe, click here to unsubscribe.
</code></pre>
<p>之後 subscription 的狀態就會變成 Confirmed；整個過程好像訂閱 maillist。</p>
</li>
</ul>
</li>
<li>
<p><a href="https://aws.amazon.com/getting-started/tutorials/filter-messages-published-to-topics/">How to Filter Messages Published to Amazon SNS Topics - AWS</a> #ril</p>
</li>
</ul>
<h2 id="large-payload">Large Payload<a class="headerlink" href="#large-payload" title="Permanent link"> #</a></h2>
<ul>
<li>
<p>SNS 跟 SQS 的 message payload <a href="https://aws.amazon.com/about-aws/whats-new/2013/06/18/amazon-sqs-announces-256KB-large-payloads/">原先都有 64 KB 的限制</a>，但 2013-06-18 為了支援更多的 use case，所以將此限制放寬到 256 KB。</p>
<p>但這並不意謂著就該將檔案直接塞進 message 裡，建議讓檔案 offloading 放到 S3，而 SNS message 只有帶有檔案的 reference 及其他 metadata 即可。</p>
<p>若不想讓 consumer 直接存取 S3 (綁定了 bucket，且整個 bucket 的內容都拿得到)，reference 可以設計成有時效的 signed URL，收到 message 的人在一定時間內都可以透過 URL 拿到檔案內容，不需要通過驗證。</p>
<p>日後有重新下載檔案的需求，則可以在 metadata 裡埋 key，回頭跟來源系統再要一次檔案；但通常不會有這個需求。</p>
</li>
</ul>
<hr />
<p>參考資料：</p>
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/sns-large-payload-raw-message-delivery.html">Amazon SNS Large Payload and Raw Message Delivery - Amazon Simple Notification Service</a></p>
<ul>
<li>
<p>Amazon SNS (and Amazon SQS) allows you to send large payload messages (from 64 to 256 kilobytes in size). To send large payloads, you must use an AWS SDK that supports Signature Version 4.</p>
<p>注意 SNS 跟 SQS 都有相同的限制 <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-limits.html#limits-messages">Limits Related to Messages - Amazon SQS Limits - Amazon Simple Queue Service</a>:</p>
<blockquote>
<p>The minimum message size is 1 byte (1 character). The maximum is 262,144 bytes (256 KB).</p>
<p>To send messages larger than 256 KB, you can use the Amazon SQS Extended Client Library for Java. This library allows you to send an Amazon SQS message that contains a REFERENCE TO A MESSAGE PAYLOAD IN AMAZON S3. The maximum payload size is 2 GB.</p>
</blockquote>
<p>將檔案放 S3 並在 SNS message 裡留下 referece，是交換大檔案常見的方法。</p>
</li>
</ul>
</li>
<li>
<p><a href="https://aws.amazon.com/about-aws/whats-new/2013/06/18/amazon-sqs-announces-256KB-large-payloads/">Amazon SQS and SNS Announce 256KB Large Payloads</a> (2013-06-18)</p>
<ul>
<li>
<p>Today, we are increasing the maximum allowed payload size for the Amazon Simple Queue Service (SQS) and the Amazon Simple Notification Service (SNS) from 64 KB to 256 KB. We are also adding a new option to deliver SNS messages in raw format, in addition to the existing JSON format. This is useful if you are using SNS in conjunction with SQS transmit IDENTICAL COPIES OF A MESSAGE to multiple queues. Here is more information about these new features:</p>
</li>
<li>
<p>256KB Payloads (SQS and SNS) enable developers to send and receive more data with each API call. Previously, payloads were capped at 64KB. Now, large payloads are billed as one request per 64KB &lsquo;chunk&rsquo; of payload. For example, a single API call for a 256KB payload will be BILLED AS FOUR REQUESTS. Our customers tell us larger payloads will enable NEW USE CASES that were previously difficult to accomplish.</p>
</li>
<li>
<p>SNS Raw Message Delivery enables developers to PACK EVEN MORE INFORMATION content into their messaging payloads. When delivering notifications to SQS and HTTP endpoints, SNS today adds JSON encoding with metadata about the current message and topic. Now, developers can set the optional <code>RawMessageDelivery</code> property to disable this added JSON encoding. Raw message delivery is OFF BY DEFAULT, to ensure existing applications continue to behave as expected.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/54224029/">compression - aws sns publising compressed payload - Stack Overflow</a> gccodec:</p>
<p>If you think that the file can increase on the time I suggest another approach.</p>
<p>Put the file on S3 bucket and attach the S3 Event Notification to SNSTopic so all consumer will be notified when a new file is ready to be processed. In other word the message of the SNS will be the LOCATION OF THE FILE and not the file it self. Think about it.</p>
<p>從 Raw Message Delivery 的角度來看，每個 S3 object 都是一個 message；這對 publisher 是比較單純，不用同時面對 SNS 與 S3 #ril</p>
</li>
<li>
<p><a href="https://www.reddit.com/r/aws/comments/8na3jg/aws_sqs_ideas_on_how_to_deal_with_256_k_limit/">AWS SQS - ideas on how to deal with 256 K limit : aws</a> (2018-05-31)</p>
<ul>
<li>
<p>tselatyjr: 800K of data is what most would consider &ldquo;blob&rdquo; sized. If you&rsquo;ve got blob data, then you should be OFFLOADING blob sized data to a &ldquo;large&rdquo; data store and REFERENCING it in the SQS message.</p>
<p>Consider storing the content in a database (DynamoDB, RDS, S3 bucket, doesn&rsquo;t matter).</p>
<p>If your payload can&rsquo;t be separated and a message created with a reference for processing, you need to reconsider how you&rsquo;ve architected your application.</p>
<p>這裡 offloading 的說法還滿能說服人的。</p>
</li>
<li>
<p>Dw0: Dynamo has record size limit, currently at 400kb, RDS is for STRUCTURED DATA. Thus S3 for blobs. The only thing, keys have to be random hashes</p>
<p>tselatyjr: Damn. I forgot DynamoDB only had 400K. Well that&rsquo;s out of the question. RDS isn&rsquo;t really suitable but it DOES solve the problem. As I mentioned, S3 is ideal.</p>
<p>大家都同意，對於 blob 這類非結構化的資料，放 S3 會比 RDBM 合適。</p>
</li>
<li>
<p>jraede: This for sure. If you generate a UUID and store the content in S3 and just run the UUID and maybe some metadata in the SQS payload, you’ll be fine scaling to thousands of ops per second. Let the managed services do the work.</p>
</li>
</ul>
</li>
</ul>
<h2 id="raw-message-delivery">Raw Message Delivery<a class="headerlink" href="#raw-message-delivery" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/sns-large-payload-raw-message-delivery.html">Amazon SNS Large Payload and Raw Message Delivery - Amazon Simple Notification Service</a></p>
<ul>
<li>
<p>In addition to sending large payloads, with Amazon SNS you can now enable RAW MESSAGE DELIVERY for messages delivered to either Amazon SQS endpoints or HTTP/S endpoints. This eliminates the need for the endpoints to process JSON formatting, which is created for the Amazon SNS metadata when raw message delivery is not selected.</p>
<p>For example when enabling raw message delivery for an Amazon SQS endpoint, the Amazon SNS metadata is not included and the published message is delivered to the subscribed Amazon SQS endpoint AS IS. When enabling raw message delivery for HTTP/S endpoints, the messages will contain an additional HTTP header <code>x-amz-sns-rawdelivery</code> with a value of <code>true</code> to indicate that the message is being published raw instead of with JSON formatting.</p>
<p>This enables those endpoints to understand what is being delivered and enables easier TRANSITION for subscriptions from JSON to raw delivery.</p>
<p>若雙方已約定好自己的格式 (也可能是 JSON)，那麼 SNS 再加一層 JSON 似乎是多餘的?</p>
</li>
<li>
<p>To enable raw message delivery using one of the AWS SDKs, you must use the <code>SetSubscriptionAttribute</code> action and configure the <code>RawMessageDelivery</code> attribute with a value of <code>true</code>. The default value is <code>false</code>.</p>
<p>不是針對單一個 message，而是針對個別 subscription。</p>
</li>
</ul>
<p>Enabling Raw Message Delivery Using the AWS Management Console</p>
<ol>
<li>Sign in to the Amazon SNS console.</li>
<li>On the navigation panel, choose Topics.</li>
<li>On the Topics page, choose a topic subscribed an Amazon SQS or HTTP/S endpoint.</li>
<li>On the MyTopic page, in the Subscription section, choose a subscription and choose Edit.</li>
<li>On the Edit EXAMPLE1-23bc-4567-d890-ef12g3hij456 page, in the Details section, choose Enable raw message delivery.</li>
<li>Choose Save changes.</li>
</ol>
</li>
<li>
<p><a href="https://aws.amazon.com/about-aws/whats-new/2013/06/18/amazon-sqs-announces-256KB-large-payloads/">Amazon SQS and SNS Announce 256KB Large Payloads</a> (2013-06-18)</p>
<p>SNS Raw Message Delivery enables developers to PACK EVEN MORE INFORMATION content into their messaging payloads. When delivering notifications to SQS and HTTP endpoints, SNS today adds JSON encoding with metadata about the current message and topic. Now, developers can set the optional <code>RawMessageDelivery</code> property to disable this added JSON encoding. Raw message delivery is OFF BY DEFAULT, to ensure existing applications continue to behave as expected.</p>
<p>為什麼說原來的 JSON format 沒有辦法帶太多資訊 ??</p>
</li>
</ul>
<h2 id="troubleshooting">疑難排解<a class="headerlink" href="#troubleshooting" title="Permanent link"> #</a></h2>
<h3 id="fifo-sqs-queues-can-not-be-subscribed-to-standard-sns-topics">FIFO SQS Queues can not be subscribed to standard SNS topics<a class="headerlink" href="#fifo-sqs-queues-can-not-be-subscribed-to-standard-sns-topics" title="Permanent link"> #</a></h3>
<p>建立 subscription 時，若 protocol 選擇 Amazon SQS 並給定 FIFO SQS 的 ARN，會出現下面的錯誤：</p>
<pre><code>Couldn't create subscription.
Error code: InvalidParameter - Error message: Invalid parameter: Invalid parameter: Endpoint Reason: FIFO SQS Queues can not be subscribed to standard SNS topics
</code></pre>

<p>參考資料：</p>
<ul>
<li>
<p><a href="https://aws.amazon.com/sns/faqs/">Amazon Simple Notification Service (SNS) FAQs – Amazon Web Services (AWS)</a></p>
<p>Q: What are the different delivery formats/transports for receiving notifications?</p>
<ul>
<li>“SQS” – Users can specify an SQS standard queue as the endpoint; Amazon SNS will enqueue a notification message to the specified queue (which subscribers can then process using SQS APIs such as <code>ReceiveMessage</code>, <code>DeleteMessage</code>, etc.). Note that FIFO queues are not currently supported.</li>
</ul>
<p>Q: Are Amazon SQS FIFO queues compatible with Amazon Simple Notification Service (SNS)?</p>
<ul>
<li>Amazon SNS does not currently support forwarding messages to Amazon SQS FIFO queues. You can use SNS to forward messages to standard queues.</li>
</ul>
</li>
<li>
<p><a href="https://forums.aws.amazon.com/thread.jspa?threadID=246962">AWS Developer Forums: FIFO queue subscribes to a SNS topic ...</a></p>
<ul>
<li>zak@AWS: (2017-01-12) This feature is not supported at the moment.</li>
<li>awschiargs: (2018-10-09) This feature request has already been submitted to the concerned team. Rest assured, we take customer feedback seriously and are always looking forward to improving our services. Unfortunately, we will be unable to provide an ETA on when this will be implemented.</li>
</ul>
</li>
<li>
<p><a href="https://www.reddit.com/r/aws/comments/6cm6u1/sns_to_sqs_as_a_microservices_event_bus_fifo/">SNS to SQS as a microservices event bus. FIFO? : aws</a> (2017-05-22)</p>
<ul>
<li>
<p>TooMuchTaurine: You are better to just put ordering / sequencing in the MESSAGE CONTENTS, and dealing with OCCASIONAL OUT OF ORDER messages with standard queue visibility timeouts and pulling the next item.</p>
<p>Anytime I hear &ldquo;must have guaranteed and ordered delivery&rdquo; it makes me wonder how this interservice architecture would handle the INEVITABLE SCENARIO OF MISSED MESSAGES. (For example a DR event where backup restore is required and one of the services loses a portion on the received data)</p>
<p>把 ordering 埋在 message 裡似乎真的是好方法 (例如 <code>event_time</code>)，而且實務上可能會重送訊息，訊息本來就可能會被打破。</p>
</li>
</ul>
</li>
</ul>
<h2 id="setup">安裝設置<a class="headerlink" href="#setup" title="Permanent link"> #</a></h2>
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/sns/latest/dg/sns-setting-up.html#create-iam-user">Step 2: Create an IAM User and Get Your AWS Credentials - Setting Up Access for Amazon SNS - Amazon Simple Notification Service</a></p>
<ul>
<li>
<p>To avoid using your IAM administrator user for Amazon SNS operations, it is a best practice to create an IAM user for EACH PERSON who needs administrative access to Amazon SNS.</p>
</li>
<li>
<p>To work with Amazon SNS, you need the <code>AmazonSNSFullAccess</code> policy and AWS credentials that are associated with your IAM user. These credentials are comprised of an access key ID and a secret access key.</p>
</li>
</ul>
</li>
</ul>
<h2 id="reference">參考資料<a class="headerlink" href="#reference" title="Permanent link"> #</a></h2>
<ul>
<li><a href="https://aws.amazon.com/sns/">Simple Notification Service (SNS) | AWS</a></li>
</ul>
<p>文件:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/sns/latest/dg/">SNS Developer Guide</a></li>
</ul>
<p>相關：</p>
<ul>
<li>實作了 <a href="../pubsub-pattern/">Pub/Sub Pattern</a>。</li>
</ul>
<p>手冊：</p>
<ul>
<li><a href="https://docs.aws.amazon.com/sns/latest/api/">SNS API Reference</a></li>
</ul></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        
        
    </footer>

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <!-- <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script> -->
    <script src="../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
